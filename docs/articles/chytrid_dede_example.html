<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian inference for a population growth model of the chytrid fungus • deBInfer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian inference for a population growth model of the chytrid fungus">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">deBInfer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chytrid_dede_example.html">Bayesian inference for a population growth model of the chytrid fungus</a>
    </li>
    <li>
      <a href="../articles/logistic_ode_example.html">Bayesian inference for the logistic growth model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pboesu/debinfer">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Bayesian inference for a population growth model of the chytrid fungus</h1>
                        <h4 class="author">Philipp H Boersch-Supan, Sadie J Ryan, and Leah R Johnson</h4>
            
            <h4 class="date">September 2016</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pboesu/debinfer/blob/master/vignettes/chytrid_dede_example.Rmd"><code>vignettes/chytrid_dede_example.Rmd</code></a></small>
      <div class="hidden name"><code>chytrid_dede_example.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level1">
<h1 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h1>
<p>This vignette illustrates the steps needed to perform inference for a DDE model of population growth in a fungal pathogen. A detailed description of the rationale behind the Bayesian inference approach for differential equations can be found in the paper describing the <code>deBInfer</code> package <span class="citation">(Boersch-Supan <em>et al.</em> 2017)</span>.</p>
<p>This example assumes that <code>deBInfer</code> is installed and loaded. If this is not the case it needs to be installed from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"deBInfer"</span>)</code></pre></div>
<p>Development versions of <code>deBInfer</code> are available on github, and can be installed using the devtools package <span class="citation">(Wickham &amp; Chang 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"devtools"</span>)){
  <span class="co">#install deBInfer from github</span>
  devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"pboesu/debinfer"</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(deBInfer)</code></pre></div>
</div>
<div id="the-chytrid-population-growth-model" class="section level1">
<h1 class="hasAnchor">
<a href="#the-chytrid-population-growth-model" class="anchor"></a>The chytrid population growth model</h1>
<p>Our example demonstrates parameter inference for a DDE model of population growth in the environmentally sensitive fungal pathogen <em>Batrachochytrium dendrobatidis</em> (Bd), which causes the amphibian disease chytridiomycosis <span class="citation">(Rosenblum <em>et al.</em> 2010; Voyles <em>et al.</em> 2012)</span>. This model has been used to further our understanding of pathogen responses to changing environmental conditions. Further details about the model development, and the experimental procedures yielding the data used for parameter inference can be found in <span class="citation">(Voyles <em>et al.</em> 2012)</span>.</p>
<p>The model follows the dynamics of the concentration of an initial cohort of zoospores, <span class="math inline">\(C\)</span>, the concentration of zoospore-producing sporangia, <span class="math inline">\(S\)</span>, and the concentration of zoospores in the next generation <span class="math inline">\(Z\)</span>. The initial cohort of zoospores, <span class="math inline">\(C\)</span>, starts at a known concentration, and zoospores in this initial cohort settle and become sporangia at rate <span class="math inline">\(s_r\)</span>, or die at rate <span class="math inline">\(\mu_Z\)</span>. <span class="math inline">\(f_s\)</span> is the fraction of sporangia that survive to the zoospore-producing stage. We assume that it takes a minimum of <span class="math inline">\(T_{min}\)</span> days before the sporangia produce zoospores, after which they produce zoospores at rate <span class="math inline">\(\eta\)</span>. Zoospore-producing sporangia die at rate <span class="math inline">\(d_s\)</span>. The concentration of zoospores, <span class="math inline">\(Z\)</span>, is the only state variable measured in the experiments, and it is assumed that these zoospores settle (<span class="math inline">\(s_r\)</span>) or die (<span class="math inline">\(\mu_Z\)</span>) at the same rates as the initial cohort of zoospores.</p>
<div id="dde-model" class="section level2">
<h2 class="hasAnchor">
<a href="#dde-model" class="anchor"></a>DDE model</h2>
<p>The equations that describe the population dynamics are as follows:</p>
<span class="math display">\[\begin{align}
\frac{dC}{dt} &amp;= -(s_r +\mu_Z) C(t) \\
\frac{dS}{dt} &amp;= s_r f_s C(t - T_{min})-d_s S(t)\\
\frac{dZ}{dt} &amp;= \eta S(t) - (s_r+\mu_Z) Z(t)
\end{align}\]</span>
<p>We can implement this system of differential equations for the <code><a href="https://rdrr.io/pkg/deSolve/man/dede.html">deSolve::dede</a></code> solver as follows. More details on how to specify differential equations for this solver can be found in the package documentation and vignettes <span class="citation">(Soetaert <em>et al.</em> 2010)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#dede version</span>
CSZ.dede&lt;-<span class="cf">function</span>(t,y,p){

  sr    &lt;-<span class="st"> </span>p[<span class="st">"sr"</span>]
  fs    &lt;-<span class="st"> </span>p[<span class="st">"fs"</span>]
  ds    &lt;-<span class="st"> </span>p[<span class="st">"ds"</span>]
  eta   &lt;-<span class="st"> </span>p[<span class="st">"eta"</span>]
  Tmin  &lt;-<span class="st"> </span>p[<span class="st">"Tmin"</span>]
  muz &lt;-<span class="st"> </span>p[<span class="st">"muz"</span>]

  Rs &lt;-<span class="st"> </span>Ms &lt;-<span class="st"> </span><span class="dv">0</span>
  lag1 &lt;-<span class="st"> </span>lag2 &lt;-<span class="st"> </span><span class="dv">0</span>

  <span class="cf">if</span> (t<span class="op">&gt;</span>Tmin) {
    lag1 &lt;-<span class="st"> </span><span class="kw">lagvalue</span>(t <span class="op">-</span><span class="st"> </span>Tmin)
    Rs &lt;-<span class="st"> </span>sr <span class="op">*</span><span class="st"> </span>fs <span class="op">*</span><span class="st"> </span>lag1[<span class="dv">1</span>]
    }

  phiZ &lt;-<span class="st"> </span>eta <span class="op">*</span><span class="st"> </span>y[<span class="dv">2</span>]
  dy1 &lt;-<span class="st"> </span><span class="op">-</span>(muz <span class="op">+</span><span class="st"> </span>sr) <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span>]
  dy2 &lt;-<span class="st"> </span>Rs <span class="op">-</span><span class="st"> </span>Ms <span class="op">-</span><span class="st"> </span>ds <span class="op">*</span><span class="st"> </span>y[<span class="dv">2</span>]
  dy3 &lt;-<span class="st"> </span>phiZ <span class="op">-</span><span class="st"> </span>(muz <span class="op">+</span><span class="st"> </span>sr) <span class="op">*</span><span class="st"> </span>y[<span class="dv">3</span>]

  <span class="cf">if</span>(y[<span class="dv">1</span>]<span class="op">&lt;</span><span class="dv">0</span>) dy1&lt;-<span class="dv">0</span>
    <span class="cf">if</span> (y[<span class="dv">2</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {
    dy2 &lt;-<span class="st"> </span>Rs <span class="op">-</span><span class="st"> </span>Ms
    dy3 &lt;-<span class="st"> </span><span class="op">-</span>(muz <span class="op">+</span><span class="st"> </span>sr) <span class="op">*</span><span class="st"> </span>y[<span class="dv">3</span>]
    }
    <span class="cf">if</span> (y[<span class="dv">3</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {
    dy3 &lt;-<span class="st"> </span>dy3 <span class="op">+</span><span class="st"> </span>(muz <span class="op">+</span><span class="st"> </span>sr) <span class="op">*</span><span class="st"> </span>y[<span class="dv">3</span>]
    }
    
    <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dy1,dy2,dy3))
    }</code></pre></div>
</div>
<div id="observation-model" class="section level2">
<h2 class="hasAnchor">
<a href="#observation-model" class="anchor"></a>Observation model</h2>
<p>Even though the data used in this example come from an experimental study, the system is only partially observed. We know the initial conditions for all states, but we only have observations for the second generation of Zoospores <span class="math inline">\(Z\)</span>. Because the observations are counts (i.e. discrete numbers), we assume that observations of the system at a set of discrete times <span class="math inline">\(t'\)</span> are independent Poisson random variables with a mean given by the solution of the DDE, at times <span class="math inline">\(t'\)</span>.</p>
<p>The observations are provided with <code>deBInfer</code>. They can be loaded with the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#load chytrid data</span>
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(chytrid)
<span class="co">#have a look at the variables</span>
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(chytrid)</code></pre></div>
<pre><code>##   time count
## 1    1     0
## 2    1     0
## 3    1     0
## 4    1     0
## 5    1     0
## 6    1     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#plot the data</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(chytrid, <span class="dt">xlab =</span> <span class="st">"Time (days)"</span>, <span class="dt">ylab =</span> <span class="st">"Zoospores x 10e4"</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">10</span>))</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/data-1.png" width="1093.75"></p>
The log-likelihood of the data given the parameters, underlying model, and initial conditions is then a sum over the <span class="math inline">\(n\)</span> observations at each time point in <span class="math inline">\(t'\)</span>
<span class="math display">\[\begin{equation}
\ell(\mathbf{Z}|\mathbf{\theta})=\sum\limits^n_{t}Z_t \text{ log }\lambda-n\lambda
\end{equation}\]</span>
<p>This can be translated into an observation model function for <code>deBInfer</code>. The observation model function must have three named arguments <code>data</code>, <code>sim.data</code>, and <code>samp</code>, as these are used by the MCMC procedure to pass in the data (as a <code>data.frame</code>, i.e. indexed using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator and the column names of the input data), the current state of the Markov chain (as a named vector), and the associated DE model solution (as a matrix-like object of class <code>deSolve</code>, i.e. indexed using the <code>[ ]</code> operator and the declared names of the state variables). We can access these inputs to define the data likelihood. In this case we have repeat measurements for each time point, so we iterate over the unique timepoints in <code>data$time</code>, and then calculate the sum log-likelihood over all matching <code>data$count</code> observations using the current value of the state variable <span class="math inline">\(Z\)</span> from the DE model solution at this point in the Markov chain.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># observation model</span>
chytrid_obs_model &lt;-<span class="st"> </span><span class="cf">function</span>(data, sim.data, samp) {
  
  ec &lt;-<span class="st"> </span><span class="fl">0.01</span>
  llik.Z &lt;-<span class="st"> </span><span class="dv">0</span>
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(data<span class="op">$</span>time)){
    <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(llik.Z &lt;-<span class="st"> </span>llik.Z <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span>(data<span class="op">$</span>count[data<span class="op">$</span>time <span class="op">==</span><span class="st"> </span>i], 
                                <span class="dt">lambda =</span> (sim.data[,<span class="st">"Z"</span>][sim.data[,<span class="st">"time"</span>] <span class="op">==</span><span class="st"> </span>i] <span class="op">+</span><span class="st"> </span>ec),
                                <span class="dt">log =</span> <span class="ot">TRUE</span>)))
  }
  llik &lt;-<span class="st"> </span>llik.Z
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(llik)
}</code></pre></div>
<p>Following Johnson et al. <span class="citation">(2013)</span> we employ a small correction <code>ec</code> that is needed because the DE solution can equal zero, whereas the parameter <code>lambda</code> of the Poisson likelihood must be strictly positive.</p>
</div>
<div id="parameter-declaration" class="section level2">
<h2 class="hasAnchor">
<a href="#parameter-declaration" class="anchor"></a>Parameter declaration</h2>
<p>We continue by defining the parameters for inference</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"sr"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                   <span class="dt">value =</span> <span class="dv">2</span>, <span class="dt">prior =</span> <span class="st">"gamma"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">shape =</span> <span class="dv">5</span>, <span class="dt">rate =</span> <span class="dv">1</span>),
                   <span class="dt">prop.var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">samp.type =</span> <span class="st">"rw-unif"</span>)

fs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"fs"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                   <span class="dt">value =</span> <span class="fl">0.5</span>, <span class="dt">prior =</span> <span class="st">"beta"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">shape1 =</span> <span class="dv">1</span>, <span class="dt">shape2 =</span> <span class="dv">1</span>),
                   <span class="dt">prop.var =</span> <span class="fl">0.01</span>, <span class="dt">samp.type =</span> <span class="st">"ind"</span>)

ds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"ds"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                   <span class="dt">value =</span> <span class="dv">2</span>, <span class="dt">prior =</span> <span class="st">"gamma"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">rate =</span> <span class="dv">1</span>),
                   <span class="dt">prop.var =</span> <span class="fl">0.1</span>, <span class="dt">samp.type =</span> <span class="st">"rw"</span>)

muz &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"muz"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                    <span class="dt">value =</span> <span class="dv">1</span>, <span class="dt">prior =</span> <span class="st">"gamma"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">shape =</span> <span class="dv">5</span>, <span class="dt">rate =</span> <span class="dv">1</span>),
                    <span class="dt">prop.var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>,<span class="dv">5</span>), <span class="dt">samp.type =</span> <span class="st">"rw-unif"</span>)

eta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"eta"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                    <span class="dt">value =</span> <span class="dv">10</span>, <span class="dt">prior =</span> <span class="st">"gamma"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">rate =</span> <span class="fl">0.25</span>),
                    <span class="dt">prop.var =</span> <span class="dv">5</span>, <span class="dt">samp.type =</span> <span class="st">"rw"</span>)

Tmin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"Tmin"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                     <span class="dt">value =</span> <span class="dv">3</span>, <span class="dt">prior =</span> <span class="st">"unif"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min =</span> <span class="dv">2</span>, <span class="dt">max =</span> <span class="dv">6</span>),
                     <span class="dt">prop.var =</span> <span class="fl">0.05</span>, <span class="dt">samp.type =</span> <span class="st">"rw"</span>)


<span class="co"># ----inits---------------------------------------------------------------</span>
C &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"C"</span>, <span class="dt">var.type =</span> <span class="st">"init"</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="dv">120</span>)
S &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"S"</span>, <span class="dt">var.type =</span> <span class="st">"init"</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="dv">0</span>)
Z &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"Z"</span>, <span class="dt">var.type =</span> <span class="st">"init"</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="dv">0</span>)</code></pre></div>
</div>
<div id="mcmc-inference" class="section level2">
<h2 class="hasAnchor">
<a href="#mcmc-inference" class="anchor"></a>MCMC Inference</h2>
<p>The declared parameters are then collated using the <code>setup_debinfer</code> function. Note that <strong>the initial values must be entered in the same order, as they are specified in the DE model function</strong>, as the solver matches these values by position, rather than by name. More details can be found in <code><a href="https://rdrr.io/pkg/deSolve/man/dede.html">?deSolve::dede</a></code>. The remaining parameters can be entered in any order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ----setup---------------------------------------------------------------</span>
mcmc.pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setup_debinfer.html">setup_debinfer</a></span>(sr, fs, ds, muz, eta, Tmin, C, S, Z)</code></pre></div>
<p><code>de_mcmc</code> is the workhorse of the package and runs the MCMC estimation. The progress of the MCMC procedure can be monitored using the <code>cnt</code>, <code>plot</code> and <code>verbose</code> options: Every <code>cnt</code> iterations the function will print out information about the current state, and, if <code>plot=TRUE</code>, traceplots of the chains will be plotted. Setting <code>verbose=TRUE</code> will print additional information. Note that frequent plotting will substantially slow down the MCMC sampler, and should be used only on short runs when tuning the sampler.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># do inference with deBInfer</span>
<span class="co"># MCMC iterations</span>
iter &lt;-<span class="st"> </span><span class="dv">500</span>
<span class="co"># inference call</span>
dede_rev &lt;-<span class="st"> </span><span class="kw"><a href="../reference/de_mcmc.html">de_mcmc</a></span>(<span class="dt">N =</span> iter, <span class="dt">data =</span> chytrid, <span class="dt">de.model =</span> CSZ.dede,
                    <span class="dt">obs.model =</span> chytrid_obs_model, <span class="dt">all.params =</span> mcmc.pars,
                    <span class="dt">Tmax =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(chytrid<span class="op">$</span>time), <span class="dt">data.times =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,chytrid<span class="op">$</span>time), <span class="dt">cnt =</span> <span class="dv">50</span>,
                    <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">sizestep =</span> <span class="fl">0.1</span>, <span class="dt">solver =</span> <span class="st">"dede"</span>, <span class="dt">verbose.mcmc =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Note that the number of iterations was set to 500 to keep the build time of the vignette within acceptable limits. For the inference results reported in Boersch-Supan and Johnson <span class="citation">(2017)</span> the MCMC procedure was run for 100000 iterations, which took about 4 hours on a 2014 Apple Mac mini with a 2.6 GHz Intel i5 processor.</p>
</div>
<div id="mcmc-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#mcmc-diagnostics" class="anchor"></a>MCMC diagnostics</h2>
<p>We plot and summarize the MCMC chains</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">4</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(dede_rev, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">auto.layout =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/unnamed-chunk-1-1.png" width="1200"> From the traceplot we can see that with only 500 iterations the chains have neither mixed well, nor reached stationarity. For demonstration purposes we remove a burnin period of 100 samples and have a look at parameter correlations, and the overlap between the posterior and prior densities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">burnin &lt;-<span class="st"> </span><span class="dv">100</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span>(dede_rev, <span class="dt">burnin =</span> burnin, <span class="dt">scatter =</span> <span class="ot">TRUE</span>, <span class="dt">trend =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/unnamed-chunk-2-1.png" width="1200"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">burnin =</span> burnin)</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/unnamed-chunk-2-2.png" width="1200"> More control over the <code>post_prior_densplot</code> can be achieved by plotting the parameters individually, using the <code>param</code> option. This way the x and y limits of the plots can be adjusted to show a larger portion of the prior support, and fancy labels can be added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">mgp =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.2</span>, <span class="fl">0.8</span>, <span class="dv">0</span>))
<span class="co">#define a fancy y axis label</span>
ylabel =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(Pr,<span class="st">"("</span>, theta,<span class="st">"|"</span>, <span class="st">"Y"</span>, <span class="st">")"</span>))
<span class="co">#plot the individual parameters</span>
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"sr"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta), 
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">8</span>),
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"s"</span>,<span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">phantom</a></span>()[{<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"r"</span>)}])))
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Posterior"</span>,<span class="st">"Prior"</span>), <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"red"</span>))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"fs"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta), 
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">1.1</span>), 
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"f"</span>,<span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">phantom</a></span>()[{<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"s"</span>)}])))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"ds"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta),
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">3</span>), 
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"d"</span>,<span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">phantom</a></span>()[{<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"s"</span>)}])))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"muz"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta),
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">6</span>),
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(mu,<span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">phantom</a></span>()[{<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Z"</span>)}])))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"eta"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta),
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">50</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="fl">0.2</span>), 
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(eta))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(dede_rev, <span class="dt">param =</span> <span class="st">"Tmin"</span>,<span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(theta),
                    <span class="dt">ylab =</span> ylabel, <span class="dt">show.obs =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>,<span class="fl">6.5</span>), 
                    <span class="dt">main =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"T"</span>,<span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">phantom</a></span>()[{<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"min"</span>)}])))</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/unnamed-chunk-3-1.png" width="1093.75"></p>
</div>
<div id="simulating-posterior-trajectories" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-posterior-trajectories" class="anchor"></a>Simulating posterior trajectories</h2>
<p>We simulate 100 DE model trajectories from the posterior and calculate the 95% highest posterior density interval for the deterministic part of the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/post_sim.html">post_sim</a></span>(dede_rev, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">by =</span> <span class="fl">0.1</span>), <span class="dt">burnin =</span> burnin, 
                      <span class="dt">output =</span> <span class="st">"all"</span>, <span class="dt">prob =</span> <span class="fl">0.95</span>)</code></pre></div>
<p>We can visualise the median posterior trajectory and the highest posterior density interval using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#median and HDI</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(post_traj, <span class="dt">plot.type =</span> <span class="st">"medianHDI"</span>, <span class="dt">auto.layout =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"posterior median"</span>, <span class="st">"95% HDI"</span>), <span class="dt">lty =</span> <span class="dv">1</span>, 
       <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>,<span class="st">"grey"</span>), <span class="dt">bty =</span> <span class="st">"n"</span>)</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/post-sims-plot-1.png" width="1200"></p>
<p>Alternatively we can plot an ensemble of posterior trajectories using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(post_traj, <span class="dt">plot.type =</span> <span class="st">"ensemble"</span>, <span class="dt">col =</span> <span class="st">"#FF000040"</span>)</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/post-sims-ensemble-1.png" width="1200"></p>
<p>Lastly, it is straightforward to create customized plots by accessing the simulated trajectories inside the <code>post_traj</code> object (as the class <code>post_sim_list</code> is simply a nested list). For example we can recreate Figure 5 in <span class="citation">Boersch-Supan <em>et al.</em> (2017)</span>, which shows the trajectories of all three state variables in a single plot, with the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(chytrid, <span class="dt">xlab =</span> <span class="st">"Time (days)"</span>, <span class="dt">ylab =</span> <span class="st">"Zoospores x 10e4"</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">10</span>))

<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(post_traj<span class="op">$</span>sims)) {
  DATA1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(post_traj<span class="op">$</span>sims[i])
  <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(DATA1[,<span class="dv">2</span>] <span class="op">~</span><span class="st"> </span>DATA1[,<span class="dv">1</span>])
  <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(DATA1[,<span class="dv">3</span>] <span class="op">~</span><span class="st"> </span>DATA1[,<span class="dv">1</span>],<span class="dt">col =</span> <span class="st">"red"</span>)
  <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(DATA1[,<span class="dv">4</span>] <span class="op">~</span><span class="st"> </span>DATA1[,<span class="dv">1</span>],<span class="dt">col =</span> <span class="st">"blue"</span>)
  }</code></pre></div>
<p><img src="chytrid_dede_example_files/figure-html/custom-sim-fig-1.png" width="1093.75"></p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-deBInfer">
<p>Boersch-Supan, P.H., Ryan, S.J. &amp; Johnson, L.R. (2017). deBInfer: Bayesian inference for dynamical models of biological systems. <em>Methods in Ecology and Evolution</em>, <strong>8</strong>, 511–518.</p>
</div>
<div id="ref-johnson2013bayesian">
<p>Johnson, L.R., Pecquerie, L. &amp; Nisbet, R.M. (2013). Bayesian inference for bioenergetic models. <em>Ecology</em>, <strong>94</strong>, 882–894.</p>
</div>
<div id="ref-rosenblum2010deadly">
<p>Rosenblum, E.B., Voyles, J., Poorten, T.J. &amp; Stajich, J.E. (2010). The deadly chytrid fungus: A story of an emerging pathogen. <em>PLoS Pathogens</em>, <strong>6</strong>, 1–3.</p>
</div>
<div id="ref-soetaert2010solving">
<p>Soetaert, K., Petzoldt, T. &amp; Setzer, R.W. (2010). Solving differential equations in R: Package deSolve. <em>Journal of Statistical Software</em>, <strong>33</strong>, 1–25.</p>
</div>
<div id="ref-voyles2012temperature">
<p>Voyles, J., Johnson, L.R., Briggs, C.J., Cashins, S.D., Alford, R.A., Berger, L., Skerratt, L.F., Speare, R. &amp; Rosenblum, E.B. (2012). Temperature alters reproductive life history patterns in <em>batrachochytrium dendrobatidis</em>, a lethal pathogen associated with the global loss of amphibians. <em>Ecology and Evolution</em>, <strong>2</strong>, 2241–2249.</p>
</div>
<div id="ref-devtools">
<p>Wickham, H. &amp; Chang, W. (2016). <em>Devtools: Tools to make developing R packages easier</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preliminaries">Preliminaries</a></li>
      <li>
<a href="#the-chytrid-population-growth-model">The chytrid population growth model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#dde-model">DDE model</a></li>
      <li><a href="#observation-model">Observation model</a></li>
      <li><a href="#parameter-declaration">Parameter declaration</a></li>
      <li><a href="#mcmc-inference">MCMC Inference</a></li>
      <li><a href="#mcmc-diagnostics">MCMC diagnostics</a></li>
      <li><a href="#simulating-posterior-trajectories">Simulating posterior trajectories</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Philipp H Boersch-Supan, Leah R Johnson, Sadie J Ryan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
